{% if google_maps_api_key %}
<script>
  // Track if maps API is loaded
  window.mapsApiLoaded = window.mapsApiLoaded || false;
  
  // Function to load Google Maps API
  function loadGoogleMapsApi() {
    if (window.mapsApiLoaded) {
      // If already loaded, just initialize the map
      if (typeof initMap === 'function') {
        initMap();
      }
      return;
    }
    
    const script = document.createElement('script');
    script.src = "https://maps.googleapis.com/maps/api/js?key={{ google_maps_api_key }}&callback=initMap";
    script.defer = true;
    script.async = true;
    script.onload = function() {
      window.mapsApiLoaded = true;
    };
    document.head.appendChild(script);
  }
  
  document.addEventListener('DOMContentLoaded', loadGoogleMapsApi);
</script>
{% endif %}