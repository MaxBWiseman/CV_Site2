{% extends 'base.html' %}
{% load static %}
{% block content %}
<script src="https://cdn.jsdelivr.net/npm/marked@4.3.0/marked.min.js"></script>
  <section class="bg-color-three-reasons">
    <div class="container-fluid">
      <div class="row justify-content-center">
        <div class="col-8 text-center mt-5 ms-2 me-2">
          <img src="{{ project.project_banner_image.url }}" alt="Project Image" />
        </div>
      </div>
      <div class="row">
        <div class="col-12 p-2">
          <div class="project-detail-container rounded mt-4 ms-2 me-2">
          <div class="row">
            <div class="col-12 text-center">
              <h3 class="uppercase bold mt-3">{{ project.title }}</h3>
          <br>
          <div class="d-flex justify-content-center">
          <a href="{{ project.github_link }}" class="btn btn-primary" target="_blank">View on GitHub</a>
          <span><p class="ms-2 mt-1 mb-0 me-2">-</p></span>
          <a href="{{ project.deployed_link }}" class="btn btn-primary" target="_blank">View Deployed Project</a>
          <span><p class="ms-2 mt-1 mb-0 me-2">-</p></span>
          <div>
            <button id="toggle-readme" class="btn btn-primary">View ReadMe</button>
          </div>
          </div>
          </div>
          </div>
          <hr>
          <article class="p-3">
            <div id="content-container">
                <div id="project-description">{{ project.description|safe }}</div>
                <div id="markdown-content" style="display: none;">{{ project.project_readme|safe }}</div>
            </div>
          </article>
        </div>
        </div>
      </div>
    </div>
  </section>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const toggleButton = document.getElementById("toggle-readme");
        const projectDescription = document.getElementById("project-description");
        const markdownContent = document.getElementById("markdown-content");
        let readmeVisible = false;
        
        // Initialize markdown rendering
        const rawMarkdown = markdownContent.textContent.trim();
        const renderedHTML = marked.parse(rawMarkdown);
        markdownContent.innerHTML = renderedHTML;
        
        // Fix image paths when markdown is rendered
        function fixImagePaths() {
            const images = markdownContent.querySelectorAll('img');
            images.forEach(img => {
                const src = img.getAttribute('src');
                if (src && (src.startsWith('./') || !src.startsWith('http') && !src.startsWith('/'))) {
                    if (src.startsWith('./')) {
                        img.src = "{{ project.github_raw_content_base_url }}" + src.substring(2);
                    } else {
                        img.src = "{{ project.github_raw_content_base_url }}" + src;
                    }
                }
            });
        }
        
        // Fix image paths at initialization
        fixImagePaths();
        
        // Toggle between description and README
        toggleButton.addEventListener("click", function() {
            if (readmeVisible) {
                markdownContent.style.display = "none";
                projectDescription.style.display = "block";
                toggleButton.textContent = "View ReadMe";
            } else {
                projectDescription.style.display = "none";
                markdownContent.style.display = "block";
                toggleButton.textContent = "View Highlights";
            }
            readmeVisible = !readmeVisible;
        });
    });
</script>
{% endblock %}